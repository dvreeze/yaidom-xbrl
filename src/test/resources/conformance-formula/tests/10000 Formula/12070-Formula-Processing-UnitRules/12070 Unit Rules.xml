<?xml version="1.0" encoding="UTF-8"?>
<!-- Copyright 2007 XBRL International. All Rights Reserved. -->
<?xml-stylesheet type="text/xsl" href="../../../infrastructure/test.xsl"?>
<testcase
  xmlns="http://xbrl.org/2008/conformance"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://xbrl.org/2008/conformance ../../../infrastructure/test.xsd"
  xmlns:xbrlfe="http://xbrl.org/2008/formula/error"
  xmlns:binding="http://xbrl.org/2008/binding/errors"
  xmlns:label="http://xbrl.org/2008/label/error"
  xmlns:reference="http://xbrl.org/2008/reference/error"  
  >
  <creator>
    <name>Herm Fischer</name>
    <email>fischer@markv.com</email>
  </creator>
  <number>12070</number>
  <name>Unit rules processing examples</name>
  <description>
    Tests of formula unit rules processing
  </description>
  <reference specification="FORMULA" id="sec-unit-rules"/>
  <reference specification="FORMULA" id="sec-default-aspect-rules"/>

  <variation id="V-01">
    <name>Output of source unit measures</name>
    <description>Tests that the output unit is that of the input.  In this case a custom kilometers/hours unit construct is used.</description>
    <reference specification="FORMULA" id="example-unit-rules"/>
    <data>
      <schema>12070-unit-tests.xsd</schema>
      <linkbase>12070-source-measures-formula.xml</linkbase>
      <instance readMeFirst="true">12070-source-measures-instance.xml</instance>
    </data>
    <result>
      <instance>12070-source-measures-result.xml</instance>
    </result>
  </variation>  

  <variation id="V-02">
    <name>Output of dynamic multiply by measure</name>
    <description>Tests that the output unit reflects that of the unit aspect rule, which replaces that of the source referenced fact item unit, because it has augment=false.</description>
    <reference specification="FORMULA" id="example-period-rules"/>
    <reference specification="FORMULA" id="sec-unit-multiplication-rules"/>
     <data>
      <schema>12070-unit-tests.xsd</schema>
      <linkbase>12070-dynamic-multBy-formula.xml</linkbase>
      <instance readMeFirst="true">12070-dynamic-multBy-instance.xml</instance>
    </data>
    <result>
      <instance>12070-dynamic-multBy-result.xml</instance>
    </result>
  </variation>  

  <variation id="V-03">
    <name>Output of complex unit from source fact item and unit rules</name>
    <description>Tests that the output unit can be assembled from a referenced monetary item (in iso4217:USD measure) divided by a price-per-share (in shares/USD unit).  The nearest referenced fact is iso4217:USD (investment amount), and the unit rules multiply by xbrli:shares and divide by iso4217:USD (reflecting dividing a dollars amount by a price per share), which results in a generated output fact item unit in xbrli:shares.  QName expressions are used for the measures manipulation.  Augment is left off (implying true).</description>
    <reference specification="FORMULA" id="example-period-rules"/>
    <reference specification="FORMULA" id="sec-unit-multiplication-rules"/>
    <reference specification="FORMULA" id="sec-unit-division-rules"/>
    <data>
      <schema>12070-unit-tests.xsd</schema>
      <linkbase>12070-dynamic-multDivToShares-formula.xml</linkbase>
      <instance readMeFirst="true">12070-dynamic-multDivToShares-instance.xml</instance>
    </data>
    <result>
      <instance>12070-dynamic-multDivToShares-result.xml</instance>
    </result>
  </variation>  

  <variation id="V-04">
    <name>Same as V-03, but the dividing-out of dollars is done by a SAV reference instead of by a QName expression.  Augment=true is explicitly specified.</name>
    <description>Tests that the output unit can be assembled from a referenced monetary item (in iso4217:USD measure) divided by a price-per-share (in shares/USD unit).
     The nearest referenced fact is iso4217:USD (investment amount), and the unit rules multiply by xbrli:shares and divide by iso4217:USD (reflecting dividing a dollars
     amount by a price per share), which results in a generated output fact item unit in xbrli:shares.
     QName expressions are used for the measures manipulation.</description>
    <reference specification="FORMULA" id="example-period-rules"/>
    <reference specification="FORMULA" id="sec-unit-multiplication-rules"/>
    <reference specification="FORMULA" id="sec-unit-division-rules"/>
    <data>
      <schema>12070-unit-tests.xsd</schema>
      <linkbase>12070-dynamic-multDivToShares2-formula.xml</linkbase>
      <instance readMeFirst="true">12070-dynamic-multDivToShares2-instance.xml</instance>
    </data>
    <result>
      <instance>12070-dynamic-multDivToShares-result.xml</instance>
    </result>
  </variation>
  
  <variation id="V-05">
    <name>Non-numeric source leads to missing unit rule</name>
      <description>
      The formula produces a numeric item but it doesn't have a unit aspect rule  
      for unit aspect.  The formula has a non-numeric fact as source, so there is no
      source unit aspect rule to use.
      </description>
    <reference specification="FORMULA" id="example-unit-rules"/>
    <data>
      <schema>12070-unit-tests.xsd</schema>
      <linkbase>12070-non-numeric-source-formula.xml</linkbase>
      <instance readMeFirst="true">12070-non-numeric-source-instance.xml</instance>
    </data>
    <result>
       <error>xbrlfe:missingUnitRule</error>
    </result>
  </variation>
  
  <variation id="V-06">
    <name>Non-numeric source plus @augment=true. Augments an empty source, so valid result produced</name>
      <description>
      The formula produces a numeric item with a non-numeric source fact. The formula contains a unit rule
      with augment=true. The SAV for unit is not defined, and thus the unit rule effectively augments
      an empty set of numerators to produce a valid unit rule. 
      </description>
    <reference specification="FORMULA" id="example-unit-rules"/>
    <data>
      <schema>12070-unit-tests.xsd</schema>
      <linkbase>12070-non-numeric-source-augmenting-measure-formula.xml</linkbase>
      <instance readMeFirst="true">12070-non-numeric-source-augmenting-measure-instance.xml</instance>
    </data>
    <result>
       <instance>12070-non-numeric-source-augmenting-measure-result.xml</instance>
    </result>
  </variation>
  
  <variation id="V-07">
    <name>Non-numeric source but unit rule with @augment=false is valid</name>
      <description>
      As per V06, except that the formula unit rule has augment=false. SAV is again undefined and the non-numeric
      source is irrelevant, so result is the same.
      </description>
    <reference specification="FORMULA" id="example-unit-rules"/>
    <data>
      <schema>12070-unit-tests.xsd</schema>
      <linkbase>12070-non-numeric-source-non-augmenting-measure-formula.xml</linkbase>
      <instance readMeFirst="true">12070-non-numeric-source-non-augmenting-measure-instance.xml</instance>
    </data>
    <result>
       <instance>12070-non-numeric-source-non-augmenting-measure-result.xml</instance>
    </result>
  </variation>

<!-- Commented out pending discussion by FWG - this case isn't actually covered by the spec, but is obviously an error or sorts. 
  <variation id="V-08">
    <name>Non augmenting unit rule supplies only divideBy, not multiply by</name>
      <description>
      Formula is non-augmenting and supplies divideBy measures only. No numerators are available, so this is an error. 
      </description>
    <reference specification="FORMULA" id="example-unit-rules"/>
    <data>
      <schema>12070-unit-tests.xsd</schema>
      <linkbase>12070-dynamic-divOnly-formula.xml</linkbase>
      <instance readMeFirst="true">12070-dynamic-divOnly-instance.xml</instance>
    </data>
    <result>
       <error>xbrlfe:missingUnitRule</error>
    </result>
  </variation>
 -->  


</testcase>


