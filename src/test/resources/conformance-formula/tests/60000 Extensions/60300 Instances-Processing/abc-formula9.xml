<?xml version="1.0" encoding="UTF-8"?>

<!-- Copyright 2007 XBRL International. All Rights Reserved. -->

<link:linkbase
  xmlns:xlink="http://www.w3.org/1999/xlink"
  xmlns:link="http://www.xbrl.org/2003/linkbase"
  xmlns:generic="http://xbrl.org/2008/generic"
  xmlns:formula="http://xbrl.org/2008/formula"
  xmlns:instance="http://xbrl.org/2010/variable/instance"
  xmlns:variable="http://xbrl.org/2008/variable"
  xmlns:cf="http://xbrl.org/2008/filter/concept"
  xmlns:df="http://xbrl.org/2008/filter/dimension"
  xmlns:pf="http://xbrl.org/2008/filter/period"
  xmlns:uf="http://xbrl.org/2008/filter/unit"
  xmlns:ca="http://xbrl.org/2008/assertion/consistency"
  xmlns:label="http://xbrl.org/2008/label"
  xmlns:xfi="http://www.xbrl.org/2008/function/instance" 
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:test1="http://abc.com/test1"
  xmlns:test2="http://abc.com/test2"
  xmlns:test3="http://abc.com/test3"
  xmlns:i="http://abc.com/instance-resource-name"

  xsi:schemaLocation="
  http://www.xbrl.org/2003/linkbase http://www.xbrl.org/2003/xbrl-linkbase-2003-12-31.xsd
  http://xbrl.org/2008/generic ../../../core_schemas/2008/generic-link.xsd
  http://xbrl.org/2008/formula ../../../core_schemas/2008/formula.xsd
  http://xbrl.org/2008/variable ../../../core_schemas/2008/variable.xsd
  http://xbrl.org/2008/assertion/consistency ../../../core_schemas/2008/consistency-assertion.xsd
  http://xbrl.org/2008/filter/concept ../../../core_schemas/2008/concept-filter.xsd
  http://xbrl.org/2008/filter/period ../../../core_schemas/2008/period-filter.xsd
  http://xbrl.org/2008/filter/unit ../../../core_schemas/2008/unit-filter.xsd
  http://xbrl.org/2008/filter/dimension ../../../core_schemas/2008/dimension-filter.xsd
  http://xbrl.org/2008/label ../../../core_schemas/2008/generic-label.xsd
  http://xbrl.org/2010/variable/instance ../../../core_schemas/2010/variable-instance.xsd
  ">
  
  <link:arcroleRef arcroleURI="http://xbrl.org/arcrole/2008/element-label" xlink:href="../../../core_schemas/2008/generic-label.xsd#element-label" xlink:type="simple"/>
  <link:arcroleRef arcroleURI="http://xbrl.org/arcrole/2008/variable-set" xlink:href="../../../core_schemas/2008/variable.xsd#variable-set" xlink:type="simple"/>
  <link:arcroleRef arcroleURI="http://xbrl.org/arcrole/2008/variable-filter" xlink:href="../../../core_schemas/2008/variable.xsd#variable-filter" xlink:type="simple"/>
  <link:roleRef roleURI="http://www.xbrl.org/2008/role/link" xlink:href="../../../core_schemas/2008/generic-link.xsd#standard-link-role" xlink:type="simple"/>

  <link:arcroleRef arcroleURI="http://xbrl.org/arcrole/2010/instance-variable" xlink:href="../../../core_schemas/2010/variable-instance.xsd#instance-variable" xlink:type="simple"/>
  <link:arcroleRef arcroleURI="http://xbrl.org/arcrole/2010/formula-instance" xlink:href="../../../core_schemas/2010/variable-instance.xsd#formula-instance" xlink:type="simple"/>

  <generic:link xlink:type="extended"
    xlink:role="http://www.xbrl.org/2008/role/link">

    <!-- input instances (all three of them) -->
    <instance:instance name="instance:standard-input-instance" xlink:type="resource" xlink:label="three-input-instances" />
    <instance:instance name="i:inst-b" xlink:type="resource" xlink:label="three-input-instances" />
    <instance:instance name="i:inst-c" xlink:type="resource" xlink:label="three-input-instances" />

    <!-- formula produces an output for each implicitly-matched
         item in both instances; no output if no implicit match in both instances
         $three-inst-items has no covered aspects so it can be used as source,
         but the source can't be on formula element, has to be on the aspect
         rule elements, to avoid causing xbrlfe:defaultAspectValueConflicts -->
    <formula:formula xlink:type="resource" xlink:label="formula1" 
      value="sum( $three-inst-a-items )"
      aspectModel="non-dimensional" implicitFiltering="true" >
      <formula:decimals>0</formula:decimals>
      <formula:aspects>
        <formula:concept>
          <!-- output uses standard input instance's namespace -->
          <formula:qname>test1:a</formula:qname>
        </formula:concept>
        <formula:entityIdentifier source="three-inst-a-items"/>
        <formula:period source="three-inst-a-items"/>
        <formula:unit source="three-inst-a-items"/>
      </formula:aspects>
    </formula:formula>

    <!--  Fact variable.  Binds to partitions of sequence that have local name "a" for each instance DTS namespace,
          covering concept name so sequences can have concept a's from 3 different namespaces in same sequence,
          and all other 3 input instances aspects same, per evaluation -->
    <variable:factVariable xlink:type="resource" xlink:label="three-inst-a-items" matches="true" bindAsSequence="true" />

    <generic:arc xlink:type="arc" 
      xlink:arcrole="http://xbrl.org/arcrole/2010/instance-variable" 
      xlink:from="three-input-instances" xlink:to="three-inst-a-items" order="1.0"/>

    <variable:variableArc xlink:type="arc" xlink:arcrole="http://xbrl.org/arcrole/2008/variable-set" 
      name="three-inst-a-items" xlink:from="formula1" xlink:to="three-inst-a-items" order="1.0"/>

    
    <variable:variableFilterArc xlink:type="arc" xlink:arcrole="http://xbrl.org/arcrole/2008/variable-filter" 
      complement="false" cover="true"
      xlink:from="three-inst-a-items" xlink:to="filter_all_insts_concept_a" order="1.0"/>

    <cf:conceptName xlink:type="resource" xlink:label="filter_all_insts_concept_a">
      <cf:concept>
        <!-- filter accepts items with localname a in each of the input XSD namespaces -->
        <cf:qname>test1:a</cf:qname>
      </cf:concept>
      <cf:concept>
        <cf:qname>test2:a</cf:qname>
      </cf:concept>
      <cf:concept>
        <cf:qname>test3:a</cf:qname>
      </cf:concept>
    </cf:conceptName>

  </generic:link>

</link:linkbase>
